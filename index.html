<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciamento de CÃ­lios</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(45deg, #1e3a8a, #4a1e8a, #8a1e4a, #1e3a8a);
            background-size: 400% 400%;
            animation: gradientAnimation 15s ease infinite;
            font-family: 'Arial', sans-serif;
            transition: all 0.3s ease;
            min-height: 100vh;
        }
        @keyframes gradientAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        body.dark-theme {
            color: #f8f9fa;
        }
        .container {
            background-color: white;
            padding: 2.5rem;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            margin-top: 2rem;
            margin-bottom: 2rem;
            transition: box-shadow 0.3s ease, transform 0.3s ease;
        }
        .container:hover {
            box-shadow: 0 12px 30px rgba(0,0,0,0.3);
            transform: translateY(-5px);
        }
        .dark-theme .container {
            background-color: #343a40;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }
        h1 {
            text-align: center;
            color: #212529;
            margin-bottom: 2rem;
            animation: fadeIn 1s ease-out;
        }
        .dark-theme h1 {
            color: #d4a017;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .form-control:focus {
            border-color: #d4a017;
            box-shadow: 0 0 8px #d4a01780;
        }
        .btn-primary {
            background: linear-gradient(45deg, #d4a017, #b8860b);
            border: none;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .btn-primary:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px #d4a01780;
        }
        .btn-secondary {
            background: linear-gradient(45deg, #212529, #343a40);
            border: none;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .btn-secondary:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px #343a4080;
        }
        .btn-warning {
            background: linear-gradient(45deg, #d4a017, #b8860b);
            border: none;
        }
        .btn-warning:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px #d4a01780;
        }
        .btn-danger {
            background: linear-gradient(45deg, #6c757d, #5a6268);
            border: none;
        }
        .btn-danger:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px #6c757d80;
        }
        #agenda {
            background: linear-gradient(135deg, #e9ecef, #f8f9fa);
            padding: 1.5rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            transition: transform 0.3s ease;
        }
        .dark-theme #agenda {
            background: linear-gradient(135deg, #343a40, #495057);
        }
        #agenda:hover {
            transform: translateY(-5px);
        }
        #agenda ul {
            list-style: none;
            padding: 0;
        }
        #agenda li {
            padding: 0.75rem;
            border-bottom: 1px solid #ced4da;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background 0.3s ease;
        }
        #agenda li:hover {
            background: #d4a01710;
        }
        .dark-theme #agenda li {
            border-bottom: 1px solid #495057;
        }
        #agenda .upcoming {
            background: linear-gradient(45deg, #d4a017, #b8860b);
            color: #212529;
            border-radius: 5px;
            padding: 0.5rem;
        }
        .dark-theme #agenda .upcoming {
            color: #f8f9fa;
        }
        .input-group-text {
            background-color: #e9ecef;
            border-color: #d4a017;
            color: #d4a017;
            transition: transform 0.3s ease;
        }
        .dark-theme .input-group-text {
            background-color: #343a40;
        }
        .input-group-text:hover {
            transform: scale(1.1);
        }
        .table th {
            background: linear-gradient(45deg, #212529, #343a40);
            color: #d4a017;
            position: relative;
            overflow: hidden;
        }
        .table th::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: #d4a017;
            transform: scaleX(0);
            transform-origin: right;
            transition: transform 0.3s ease;
        }
        .table th:hover::after {
            transform: scaleX(1);
            transform-origin: left;
        }
        .dark-theme .table th {
            background: linear-gradient(45deg, #343a40, #495057);
        }
        .table td {
            transition: background 0.3s ease, transform 0.3s ease;
            position: relative;
        }
        .table td:hover {
            background: #d4a01710;
            transform: scale(1.02);
        }
        .table td:first-child {
            cursor: pointer;
        }
        .table td:first-child::before {
            content: '\f007';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            margin-right: 8px;
            color: #d4a017;
            transition: transform 0.3s ease;
        }
        .table td:first-child:hover::before {
            transform: rotate(360deg);
        }
        .table td:first-child:active::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, #d4a01750, transparent);
            border-radius: 50%;
            transform: translate(-50%, -50%) scale(0);
            animation: ripple 0.6s ease-out;
        }
        @keyframes ripple {
            to { transform: translate(-50%, -50%) scale(2); opacity: 0; }
        }
        .whatsapp-btn {
            color: #25D366;
            font-size: 1.5rem;
            transition: transform 0.3s ease, color 0.3s ease;
        }
        .whatsapp-btn:hover {
            color: #128C7E;
            transform: scale(1.2) rotate(360deg);
        }
        .whatsapp-icon {
            font-family: 'Font Awesome 6 Free' !important;
            font-weight: 900;
            font-size: 1.5rem;
            color: #25D366;
            margin-right: 5px;
            transition: transform 0.3s ease, color 0.3s ease;
        }
        .whatsapp-icon:hover {
            color: #128C7E;
            transform: scale(1.2) rotate(360deg);
        }
        .ok-btn {
            color: #d4a017;
            font-size: 1.5rem;
            transition: transform 0.3s ease, color 0.3s ease;
        }
        .ok-btn:hover {
            color: #b8860b;
            transform: scale(1.2);
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1.2); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1.2); }
        }
        .apply-btn {
            color: #212529;
            font-size: 1.5rem;
            transition: transform 0.3s ease, color 0.3s ease;
        }
        .apply-btn:hover {
            color: #343a40;
            transform: scale(1.2) rotate(360deg);
        }
        .maint-btn {
            color: #d4a017;
            font-size: 1.5rem;
            transition: transform 0.3s ease, color 0.3s ease;
        }
        .maint-btn:hover {
            color: #b8860b;
            transform: scale(1.2) rotate(360deg);
        }
        .nav-tabs .nav-link.active {
            background: linear-gradient(45deg, #d4a017, #b8860b);
            color: #212529;
            border: none;
        }
        .dark-theme .nav-tabs .nav-link.active {
            color: #f8f9fa;
        }
        .search-highlight {
            border: 2px solid #d4a017;
            background-color: #e9ecef;
            animation: highlight 1s ease-out;
        }
        .dark-theme .search-highlight {
            background-color: #495057;
        }
        @keyframes highlight {
            from { background-color: #d4a01730; }
            to { background-color: #e9ecef; }
        }
        #searchInput:focus + .input-group-text .fa-magnifying-glass {
            animation: heartbeat 1s infinite;
        }
        @keyframes heartbeat {
            0% { transform: scale(1); }
            20% { transform: scale(1.2); }
            40% { transform: scale(1); }
            60% { transform: scale(1.2); }
            80% { transform: scale(1); }
        }
        #searchInput {
            max-width: 400px;
            transition: box-shadow 0.3s ease;
        }
        #searchInput:focus {
            box-shadow: 0 0 10px #d4a01780;
        }
        .header {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        .theme-toggle {
            color: #d4a017;
            font-size: 2rem;
            cursor: pointer;
            transition: transform 0.3s ease, color 0.3s ease;
        }
        .theme-toggle:hover {
            color: #b8860b;
            transform: rotate(360deg);
        }
        #currentDateTime {
            font-size: 1.2rem;
            color: #d4a017;
            animation: fadeIn 1s ease-out;
        }
        .client-details-list {
            list-style: none;
            padding: 0;
        }
        .client-details-list li {
            padding: 0.5rem 0;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: color 0.3s ease;
        }
        .client-details-list li:hover {
            color: #d4a017;
        }
        .client-details-list li i {
            font-size: 1.2rem;
            color: #d4a017;
            transition: transform 0.3s ease;
            animation: pulse 2s infinite;
        }
        .client-details-list li:hover i {
            transform: scale(1.2);
        }
        .dark-theme .modal-content {
            background-color: #121212;
            animation: zoomIn 0.3s ease-out;
        }
        .modal-content {
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            transition: box-shadow 0.3s ease, transform 0.3s ease;
        }
        .modal-content:hover {
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
            transform: translateY(-5px);
        }
        .dark-theme .modal-header, .dark-theme .modal-footer {
            background: linear-gradient(45deg, #212529, #343a40);
            color: #d4a017;
        }
        .modal-header {
            background: linear-gradient(45deg, #d4a017, #b8860b);
            color: #212529;
        }
        @keyframes zoomIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .modal-body .btn i {
            transition: transform 0.3s ease;
        }
        .modal-body .btn:hover i {
            transform: rotate(360deg);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header" data-aos="fade-down">
            <i id="themeToggle" class="fas fa-sun theme-toggle"></i>
            <span id="currentDateTime"></span>
        </div>
        <h1 data-aos="fade-down">Gerenciamento de CÃ­lios</h1>
        <div id="agenda" data-aos="fade-up">
            <h2><i class="fas fa-calendar-days"></i> Agenda de ManutenÃ§Ãµes</h2>
            <ul id="agenda-list"></ul>
        </div>
        <div class="d-flex gap-2 mb-4">
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#cadastroModal" data-aos="fade-up"><i class="fas fa-plus-circle"></i> Cadastrar Cliente</button>
            <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#messageConfigModal" data-aos="fade-up"><i class="fas fa-gear"></i> Configurar Mensagens</button>
        </div>
        <div id="clients-list" data-aos="fade-up">
            <h2><i class="fas fa-users"></i> Clientes Cadastrados</h2>
            <div class="mb-3">
                <div class="input-group" style="max-width: 100vw;">
                    <span class="input-group-text"><i class="fas fa-magnifying-glass"></i></span>
                    <input type="text" class="form-control" id="searchInput" placeholder="Pesquisar por nome, WhatsApp ou data...">
                </div>
            </div>
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>WhatsApp</th>
                        </tr>
                    </thead>
                    <tbody id="clients-table-body">
                        <!-- Clients will be added here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal de Cadastro/EdiÃ§Ã£o -->
    <div class="modal fade" id="cadastroModal" tabindex="-1" aria-labelledby="cadastroModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="cadastroModalLabel">Cadastrar Cliente</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="cadastroForm">
                        <input type="hidden" id="editIndex" name="editIndex">
                        <div class="mb-3">
                            <label for="name" class="form-label">Nome:</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-user"></i></span>
                                <input type="text" class="form-control" id="name" name="name" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="whatsapp" class="form-label">WhatsApp:</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fab fa-whatsapp"></i></span>
                                <input type="tel" class="form-control" id="whatsapp" name="whatsapp" pattern="\+55\s?\d{2}\s?\d{9}" placeholder="+55 11 91234-5678" required>
                            </div>
                            <small class="form-text text-muted">Formato: +55 11 91234-5678</small>
                        </div>
                        <div class="mb-3">
                            <label for="application_date" class="form-label">Data da AplicaÃ§Ã£o:</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-calendar-day"></i></span>
                                <input type="date" class="form-control" id="application_date" name="application_date" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="application_time" class="form-label">HorÃ¡rio da AplicaÃ§Ã£o:</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-clock"></i></span>
                                <input type="time" class="form-control" id="application_time" name="application_time" min="08:00" max="18:00" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="maintenance_date" class="form-label">Data da ManutenÃ§Ã£o:</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-calendar-check"></i></span>
                                <input type="date" class="form-control" id="maintenance_date" name="maintenance_date" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="maintenance_time" class="form-label">HorÃ¡rio da ManutenÃ§Ã£o:</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-clock"></i></span>
                                <input type="time" class="form-control" id="maintenance_time" name="maintenance_time" min="08:00" max="18:00" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="application_value" class="form-label">Valor da AplicaÃ§Ã£o:</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-dollar-sign"></i></span>
                                <input type="number" class="form-control" id="application_value" name="application_value" step="0.01" min="0" required>
                            </div>
                        </div>
        <div class="mb-3">
            <label for="maintenance_value" class="form-label">Valor da ManutenÃ§Ã£o:</label>
            <div class="input-group">
                <span class="input-group-text"><i class="fas fa-dollar-sign"></i></span>
                <input type="number" class="form-control" id="maintenance_value" name="maintenance_value" step="0.01" min="0" required>
            </div>
        </div>
        <div class="mb-3">
            <label for="eyelash_model" class="form-label">Modelo do CÃ­lios:</label>
            <div class="input-group">
                <span class="input-group-text"><i class="fas fa-eye"></i></span>
                <select class="form-control" id="eyelash_model" name="eyelash_model" required>
                    <option value="">Selecione o modelo</option>
                    <option value="brasileiro">Brasileiro</option>
                    <option value="egipcio">EgÃ­pcio</option>
                    <option value="4d">4D</option>
                    <option value="5d">5D</option>
                    <option value="fio_a_fio">Fio a Fio</option>
                    <option value="fox">Fox</option>
                </select>
            </div>
        </div>
        <button type="submit" class="btn btn-primary"><i class="fas fa-floppy-disk"></i> Salvar</button>
    </form>
</div>
</div>
</div>
</div>

<!-- Modal de ConfiguraÃ§Ã£o de Mensagens -->
<div class="modal fade" id="messageConfigModal" tabindex="-1" aria-labelledby="messageConfigModalLabel" aria-hidden="true">
<div class="modal-dialog">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="messageConfigModalLabel">Configurar Mensagens do WhatsApp</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <ul class="nav nav-tabs" id="messageTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="application-tab" data-bs-toggle="tab" data-bs-target="#application" type="button" role="tab" aria-controls="application" aria-selected="true">AplicaÃ§Ã£o</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="maintenance-tab" data-bs-toggle="tab" data-bs-target="#maintenance" type="button" role="tab" aria-controls="maintenance" aria-selected="false">ManutenÃ§Ã£o</button>
                </li>
            </ul>
            <div class="tab-content" id="messageTabContent">
                <div class="tab-pane fade show active" id="application" role="tabpanel" aria-labelledby="application-tab">
                    <form id="applicationMessageForm" class="mt-3">
                        <div class="mb-3">
                            <label for="applicationMessageTemplate" class="form-label">Modelo da Mensagem de AplicaÃ§Ã£o:</label>
                            <textarea class="form-control" id="applicationMessageTemplate" name="applicationMessageTemplate" rows="5" required></textarea>
                            <small class="form-text text-muted">Use as variÃ¡veis: {nome}, {data_aplicacao}, {hora_aplicacao}, {valor_aplicacao}, {data_manutencao}, {hora_manutencao}, {valor_manutencao}</small>
                        </div>
                        <button type="submit" class="btn btn-primary"><i class="fas fa-floppy-disk"></i> Salvar</button>
                    </form>
                </div>
                <div class="tab-pane fade" id="maintenance" role="tabpanel" aria-labelledby="maintenance-tab">
                    <form id="maintenanceMessageForm" class="mt-3">
                        <div class="mb-3">
                            <label for="maintenanceMessageTemplate" class="form-label">Modelo da Mensagem de ManutenÃ§Ã£o:</label>
                            <textarea class="form-control" id="maintenanceMessageTemplate" name="maintenanceMessageTemplate" rows="5" required></textarea>
                            <small class="form-text text-muted">Use as variÃ¡veis: {nome}, {data_aplicacao}, {hora_aplicacao}, {valor_aplicacao}, {data_manutencao}, {hora_manutencao}, {valor_manutencao}</small>
                        </div>
                        <button type="submit" class="btn btn-primary"><i class="fas fa-floppy-disk"></i> Salvar</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
</div>

<!-- Modal de Nova ManutenÃ§Ã£o -->
<div class="modal fade" id="newMaintenanceModal" tabindex="-1" aria-labelledby="newMaintenanceModalLabel" aria-hidden="true">
<div class="modal-dialog">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="newMaintenanceModalLabel">Agendar Nova ManutenÃ§Ã£o</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <form id="newMaintenanceForm">
                <input type="hidden" id="maintenanceIndex" name="maintenanceIndex">
                <div class="mb-3">
                    <label for="new_maintenance_date" class="form-label">Data da ManutenÃ§Ã£o:</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-calendar-check"></i></span>
                        <input type="date" class="form-control" id="new_maintenance_date" name="new_maintenance_date" required>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="new_maintenance_time" class="form-label">HorÃ¡rio da ManutenÃ§Ã£o:</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-clock"></i></span>
                        <input type="time" class="form-control" id="new_maintenance_time" name="new_maintenance_time" min="08:00" max="18:00" required>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="new_maintenance_value" class="form-label">Valor da ManutenÃ§Ã£o:</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-dollar-sign"></i></span>
                        <input type="number" class="form-control" id="new_maintenance_value" name="new_maintenance_value" step="0.01" min="0" required>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="new_eyelash_model" class="form-label">Modelo do CÃ­lios:</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-eye"></i></span>
                        <select class="form-control" id="new_eyelash_model" name="new_eyelash_model" required>
                            <option value="">Selecione o modelo</option>
                            <option value="brasileiro">Brasileiro</option>
                            <option value="egipcio">EgÃ­pcio</option>
                            <option value="4d">4D</option>
                            <option value="5d">5D</option>
                            <option value="fio_a_fio">Fio a Fio</option>
                            <option value="fox">Fox</option>
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary"><i class="fas fa-floppy-disk"></i> Salvar</button>
            </form>
        </div>
    </div>
</div>
</div>

<!-- Modal de Detalhes do Cliente -->
<div class="modal fade" id="clientDetailsModal" tabindex="-1" aria-labelledby="clientDetailsModalLabel" aria-hidden="true">
<div class="modal-dialog">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="clientDetailsModalLabel">Detalhes do Cliente</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <ul class="client-details-list" id="client-details-list">
                <!-- Details will be added here -->
            </ul>
            <div class="d-flex gap-2 mt-3">
                <a id="whatsappApplicationLink" href="#" target="_blank" class="btn btn-primary"><i class="fas fa-calendar-plus"></i> Enviar Mensagem de AplicaÃ§Ã£o</a>
                <a id="whatsappMaintenanceLink" href="#" target="_blank" class="btn btn-primary"><i class="fas fa-wrench"></i> Enviar Mensagem de ManutenÃ§Ã£o</a>
            </div>
            <div class="d-flex gap-2 mt-3">
                <button id="editClientButton" class="btn btn-warning"><i class="fas fa-pencil"></i> Editar</button>
                <button id="deleteClientButton" class="btn btn-danger"><i class="fas fa-trash"></i> Excluir</button>
            </div>
        </div>
    </div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
<script>
    const eyelashModels = {
        brasileiro: 'Brasileiro',
        egipcio: 'EgÃ­pcio',
        '4d': '4D',
        '5d': '5D',
        fio_a_fio: 'Fio a Fio',
        fox: 'Fox'
    };

    const defaultApplicationMessageTemplate = `ð *Lembrete de agendamento*

OlÃ¡ {nome}, tudo bem?

â¨ Sua aplicaÃ§Ã£o de cÃ­lios estÃ¡ agendada para *{data_aplicacao}*.

Confira os detalhes abaixo:

â° HorÃ¡rio: {hora_aplicacao}
ð¸ Valor: {valor_aplicacao}

ð Em caso de atraso, por favor avise com pelo menos 2 horas de antecedÃªncia.

ð Se houver necessidade de remarcar, peÃ§o que avise com no mÃ­nimo 1 dia de antecedÃªncia.

Em caso de dÃºvidas ou imprevistos, Ã© sÃ³ me chamar! ð¬
AgradeÃ§o pela confianÃ§a ð`;

    const defaultMaintenanceMessageTemplate = `ð *Lembrete de agendamento*

OlÃ¡ {nome}, tudo bem?

â¨ Sua manutenÃ§Ã£o de cÃ­lios estÃ¡ agendada para *{data_manutencao}*.

Confira os detalhes abaixo:

â° HorÃ¡rio: {hora_manutencao}
ð¸ Valor: {valor_manutencao}

ð Em caso de atraso, por favor avise com pelo menos 2 horas de antecedÃªncia.

ð Se houver necessidade de remarcar, peÃ§o que avise com no mÃ­nimo 1 dia de antecedÃªncia.

Em caso de dÃºvidas ou imprevistos, Ã© sÃ³ me chamar! ð¬
AgradeÃ§o pela confianÃ§a ð`;

    function formatDate(dateStr) {
        const [year, month, day] = dateStr.split('-');
        return `${day}/${month}/${year}`;
    }

    function formatTime(timeStr) {
        const [hours, minutes] = timeStr.split(':');
        return `${hours}:${minutes}`;
    }

    function updateDateTime() {
        const now = new Date();
        const day = String(now.getDate()).padStart(2, '0');
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const year = now.getFullYear();
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        document.getElementById('currentDateTime').textContent = `${day}/${month}/${year} ${hours}:${minutes}`;
    }

    function toggleTheme() {
        const body = document.body;
        const themeToggle = document.getElementById('themeToggle');
        if (body.classList.contains('dark-theme')) {
            body.classList.remove('dark-theme');
            themeToggle.classList.remove('fa-moon');
            themeToggle.classList.add('fa-sun');
            localStorage.setItem('theme', 'light');
        } else {
            body.classList.add('dark-theme');
            themeToggle.classList.remove('fa-sun');
            themeToggle.classList.add('fa-moon');
            localStorage.setItem('theme', 'dark');
        }
    }

    function getClients() {
        return new Promise((resolve) => {
            const clientsJson = localStorage.getItem('clients');
            resolve(clientsJson ? JSON.parse(clientsJson) : []);
        });
    }

    function saveClients(clients) {
        return new Promise((resolve) => {
            localStorage.setItem('clients', JSON.stringify(clients));
            resolve();
        });
    }

    function getApplicationMessageTemplate() {
        return localStorage.getItem('applicationMessageTemplate') || defaultApplicationMessageTemplate;
    }

    function saveApplicationMessageTemplate(template) {
        localStorage.setItem('applicationMessageTemplate', template);
    }

    function getMaintenanceMessageTemplate() {
        return localStorage.getItem('maintenanceMessageTemplate') || defaultMaintenanceMessageTemplate;
    }

    function saveMaintenanceMessageTemplate(template) {
        localStorage.setItem('maintenanceMessageTemplate', template);
    }

    function validateForm(client) {
        const today = new Date().toISOString().split('T')[0];
        if (client.maintenance_date < client.application_date) {
            alert('A data da manutenÃ§Ã£o deve ser apÃ³s a data da aplicaÃ§Ã£o.');
            return false;
        }
        if (client.application_date < today) {
            alert('A data da aplicaÃ§Ã£o nÃ£o pode ser anterior a hoje.');
            return false;
        }
        const whatsappRegex = /^\+55\s?\d{2}\s?\d{9}$/;
        if (!whatsappRegex.test(client.whatsapp)) {
            alert('Por favor, insira um WhatsApp vÃ¡lido no formato +55 11 91234-5678.');
            return false;
        }
        return true;
    }

    function validateMaintenanceForm(maintenance) {
        const today = new Date().toISOString().split('T')[0];
        if (maintenance.new_maintenance_date < today) {
            alert('A data da manutenÃ§Ã£o nÃ£o pode ser anterior a hoje.');
            return false;
        }
        return true;
    }

    function generateWhatsAppMessage(client, type) {
        const template = type === 'application' ? getApplicationMessageTemplate() : getMaintenanceMessageTemplate();
        return template
            .replace('{nome}', client.name)
            .replace('{data_aplicacao}', formatDate(client.application_date))
            .replace('{hora_aplicacao}', formatTime(client.application_time))
            .replace('{valor_aplicacao}', parseFloat(client.application_value).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }))
            .replace('{data_manutencao}', formatDate(client.maintenance_date))
            .replace('{hora_manutencao}', formatTime(client.maintenance_time))
            .replace('{valor_manutencao}', parseFloat(client.maintenance_value).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }));
    }

    function generateWhatsAppLink(client, type) {
        const message = generateWhatsAppMessage(client, type);
        const encodedMessage = encodeURIComponent(message);
        return `https://wa.me/${client.whatsapp.replace(/\s/g, '')}?text=${encodedMessage}`;
    }

    async function showClientDetails(index) {
        const clients = await getClients();
        const client = clients[index];
        const detailsList = document.getElementById('client-details-list');
        detailsList.innerHTML = `
            <li><i class="fas fa-user"></i> <strong>Nome:</strong> ${client.name}</li>
            <li><i class="fab fa-whatsapp"></i> <strong>WhatsApp:</strong> ${client.whatsapp}</li>
            <li><i class="fas fa-calendar-day"></i> <strong>Data da AplicaÃ§Ã£o:</strong> ${formatDate(client.application_date)}</li>
            <li><i class="fas fa-clock"></i> <strong>HorÃ¡rio da AplicaÃ§Ã£o:</strong> ${formatTime(client.application_time)}</li>
            <li><i class="fas fa-calendar-check"></i> <strong>Data da ManutenÃ§Ã£o:</strong> ${formatDate(client.maintenance_date)}</li>
            <li><i class="fas fa-clock"></i> <strong>HorÃ¡rio da ManutenÃ§Ã£o:</strong> ${formatTime(client.maintenance_time)}</li>
            <li><i class="fas fa-dollar-sign"></i> <strong>Valor da AplicaÃ§Ã£o:</strong> ${parseFloat(client.application_value).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</li>
            <li><i class="fas fa-dollar-sign"></i> <strong>Valor da ManutenÃ§Ã£o:</strong> ${parseFloat(client.maintenance_value).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</li>
            <li><i class="fas fa-eye"></i> <strong>Modelo do CÃ­lios:</strong> ${eyelashModels[client.eyelash_model] || client.eyelash_model}</li>
        `;
        document.getElementById('whatsappApplicationLink').href = generateWhatsAppLink(client, 'application');
        document.getElementById('whatsappMaintenanceLink').href = generateWhatsAppLink(client, 'maintenance');
        document.getElementById('editClientButton').onclick = () => editClient(index);
        document.getElementById('deleteClientButton').onclick = () => deleteClient(index);
        bootstrap.Modal.getOrCreateInstance(document.getElementById('clientDetailsModal')).show();
    }

    async function updateClientsTable(searchTerm = '') {
        const clients = await getClients();
        const tbody = document.getElementById('clients-table-body');
        tbody.innerHTML = '';
        let filteredClients = clients.map((client, index) => ({ ...client, index }));
        
        if (searchTerm) {
            const lowerSearchTerm = searchTerm.toLowerCase();
            filteredClients = filteredClients.filter(client => 
                client.name.toLowerCase().includes(lowerSearchTerm) ||
                client.whatsapp.toLowerCase().includes(lowerSearchTerm) ||
                formatDate(client.application_date).includes(lowerSearchTerm) ||
                formatDate(client.maintenance_date).includes(lowerSearchTerm)
            );
        }

        filteredClients.forEach((client, idx) => {
            const row = document.createElement('tr');
            const isHighlighted = searchTerm && (
                client.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                client.whatsapp.toLowerCase().includes(searchTerm.toLowerCase()) ||
                formatDate(client.application_date).includes(searchTerm.toLowerCase()) ||
                formatDate(client.maintenance_date).includes(searchTerm.toLowerCase())
            );
            if (isHighlighted) row.classList.add('search-highlight');
            row.setAttribute('data-aos', 'fade-up');
            row.setAttribute('data-aos-delay', idx * 100);
            row.innerHTML = `
                <td onclick="showClientDetails(${client.index})">${client.name}</td>
                <td><i class="fab fa-whatsapp .whatsapp-icon"></i>${client.whatsapp}</td>
            `;
            tbody.appendChild(row);
        });
    }

    async function updateAgenda() {
        const clients = await getClients();
        const agendaList = document.getElementById('agenda-list');
        agendaList.innerHTML = '';
        const today = new Date();
        const oneWeekFromNow = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
        const upcomingClients = clients
            .map((client, index) => ({ ...client, index }))
            .filter(client => {
                const maintenanceDate = new Date(`${client.maintenance_date}T${client.maintenance_time}`);
                return maintenanceDate >= today;
            })
            .sort((a, b) => {
                const dateA = new Date(`${a.maintenance_date}T${a.maintenance_time}`);
                const dateB = new Date(`${b.maintenance_date}T${b.maintenance_time}`);
                return dateA - dateB;
            });
        upcomingClients.forEach((client, idx) => {
            const maintenanceDate = new Date(`${client.maintenance_date}T${client.maintenance_time}`);
            const isUpcoming = maintenanceDate <= oneWeekFromNow;
            const li = document.createElement('li');
            li.className = isUpcoming ? 'upcoming' : '';
            li.setAttribute('data-aos', 'fade-right');
            li.setAttribute('data-aos-delay', idx * 100);
            li.innerHTML = `
                <i class="fas fa-user"></i> 
                ${client.name} - ManutenÃ§Ã£o: ${formatDate(client.maintenance_date)} Ã s ${formatTime(client.maintenance_time)} ${isUpcoming ? '<span>(PrÃ³xima semana)</span>' : ''}
                <a href="${generateWhatsAppLink(client, 'maintenance')}" target="_blank" class="whatsapp-btn"><i class="fab fa-whatsapp"></i></a>
                <span onclick="openNewMaintenance(${client.index})" class="ok-btn"><i class="fas fa-check-circle"></i></span>
                <a href="${generateWhatsAppLink(client, 'application')}" target="_blank" class="apply-btn"><i class="fas fa-calendar-plus"></i></a>
                <a href="${generateWhatsAppLink(client, 'maintenance')}" target="_blank" class="maint-btn"><i class="fas fa-wrench"></i></a>
            `;
            agendaList.appendChild(li);
        });
    }

    async function editClient(index) {
        const clients = await getClients();
        const client = clients[index];
        const modal = document.getElementById('cadastroModal');
        const modalTitle = document.getElementById('cadastroModalLabel');
        modalTitle.textContent = 'Editar Cliente';
        document.getElementById('editIndex').value = index;
        document.getElementById('name').value = client.name;
        document.getElementById('whatsapp').value = client.whatsapp;
        document.getElementById('application_date').value = client.application_date;
        document.getElementById('application_time').value = client.application_time;
        document.getElementById('maintenance_date').value = client.maintenance_date;
        document.getElementById('maintenance_time').value = client.maintenance_time;
        document.getElementById('application_value').value = client.application_value;
        document.getElementById('maintenance_value').value = client.maintenance_value;
        document.getElementById('eyelash_model').value = client.eyelash_model;
        bootstrap.Modal.getOrCreateInstance(modal).show();
        bootstrap.Modal.getInstance(document.getElementById('clientDetailsModal')).hide();
    }

    async function deleteClient(index) {
        if (confirm('Deseja realmente excluir este cliente?')) {
            const clients = await getClients();
            clients.splice(index, 1);
            await saveClients(clients);
            await updateClientsTable(document.getElementById('searchInput').value);
            await updateAgenda();
            bootstrap.Modal.getInstance(document.getElementById('clientDetailsModal')).hide();
            alert('Cliente excluÃ­do com sucesso!');
        }
    }

    async function openNewMaintenance(index) {
        const modal = document.getElementById('newMaintenanceModal');
        document.getElementById('maintenanceIndex').value = index;
        document.getElementById('new_maintenance_date').value = '';
        document.getElementById('new_maintenance_time').value = '';
        document.getElementById('new_maintenance_value').value = '';
        document.getElementById('new_eyelash_model').value = '';
        bootstrap.Modal.getOrCreateInstance(modal).show();
    }

    function searchClients() {
        const searchInput = document.getElementById('searchInput').value;
        updateClientsTable(searchInput);
    }

    document.getElementById('cadastroForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        const client = {};
        for (let [key, value] of formData.entries()) {
            client[key] = value;
        }
        if (!validateForm(client)) return;
        const clients = await getClients();
        const editIndex = parseInt(client.editIndex);
        if (!isNaN(editIndex)) {
            clients[editIndex] = client;
        } else {
            clients.push(client);
        }
        await saveClients(clients);
        await updateClientsTable(document.getElementById('searchInput').value);
        await updateAgenda();
        this.reset();
        document.getElementById('editIndex').value = '';
        document.getElementById('cadastroModalLabel').textContent = 'Cadastrar Cliente';
        bootstrap.Modal.getInstance(document.getElementById('cadastroModal')).hide();
        alert(!isNaN(editIndex) ? 'Cliente atualizado com sucesso!' : 'Cliente cadastrado com sucesso!');
    });

    document.getElementById('newMaintenanceForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        const maintenance = {};
        for (let [key, value] of formData.entries()) {
            maintenance[key] = value;
        }
        if (!validateMaintenanceForm(maintenance)) return;
        const clients = await getClients();
        const index = parseInt(maintenance.maintenanceIndex);
        clients[index].maintenance_date = maintenance.new_maintenance_date;
        clients[index].maintenance_time = maintenance.new_maintenance_time;
        clients[index].maintenance_value = maintenance.new_maintenance_value;
        clients[index].eyelash_model = maintenance.new_eyelash_model;
        await saveClients(clients);
        await updateClientsTable(document.getElementById('searchInput').value);
        await updateAgenda();
        this.reset();
        bootstrap.Modal.getInstance(document.getElementById('newMaintenanceModal')).hide();
        alert('Nova manutenÃ§Ã£o agendada com sucesso!');
    });

    document.getElementById('applicationMessageForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        const template = formData.get('applicationMessageTemplate');
        saveApplicationMessageTemplate(template);
        alert('Modelo de mensagem de aplicaÃ§Ã£o salvo com sucesso!');
    });

    document.getElementById('maintenanceMessageForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        const template = formData.get('maintenanceMessageTemplate');
        saveMaintenanceMessageTemplate(template);
        alert('Modelo de mensagem de manutenÃ§Ã£o salvo com sucesso!');
    });

    document.getElementById('searchInput').addEventListener('input', searchClients);

    document.getElementById('themeToggle').addEventListener('click', toggleTheme);

    document.addEventListener('DOMContentLoaded', async function() {
        const savedTheme = localStorage.getItem('theme') || 'light';
        if (savedTheme === 'dark') {
            document.body.classList.add('dark-theme');
            document.getElementById('themeToggle').classList.remove('fa-sun');
            document.getElementById('themeToggle').classList.add('fa-moon');
        }
        await updateClientsTable();
        await updateAgenda();
        document.getElementById('applicationMessageTemplate').value = getApplicationMessageTemplate();
        document.getElementById('maintenanceMessageTemplate').value = getMaintenanceMessageTemplate();
        updateDateTime();
        setInterval(updateDateTime, 1000);
        AOS.init({ duration: 800, once: true });
    });
</script>
</body>
</html>
