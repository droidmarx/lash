<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciamento de C√≠lios</title>
<link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/32/3465/3465289.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-light: #F472B6;
            --secondary-light: #FBBF24;
            --bg-light: #FFFFFF;
            --text-light: #1F2937;
            --whatsapp: #4CAF50;
            --whatsapp-hover: #2E7D32;
            --primary-dark: #6D28D9;
            --secondary-dark: #D97706;
            --bg-dark: #111827;
            --text-dark: #F9FAFB;
        }
        body {
            background: linear-gradient(135deg, var(--primary-light), var(--secondary-light), var(--bg-light), var(--primary-light));
            background-size: 400% 400%;
            animation: gradientAnimation 12s ease infinite;
            font-family: 'Poppins', sans-serif;
            min-height: 100vh;
            color: var(--text-light);
            transition: all 0.3s ease;
        }
        body.dark-theme {
            background: linear-gradient(135deg, var(--primary-dark), var(--secondary-dark), var(--bg-dark), var(--primary-dark));
            color: var(--text-dark);
        }
        @keyframes gradientAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .navbar {
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(8px);
        }
        .dark-theme .navbar {
            background: rgba(17, 24, 39, 0.9);
        }
        .navbar-brand {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-light);
        }
        .dark-theme .navbar-brand {
            color: var(--primary-dark);
        }
        .container-main {
            background: var(--bg-light);
            padding: 2rem;
            border-radius: 32px;
            box-shadow: 0 8px 24px rgba(244, 114, 182, 0.4);
            margin: 2rem auto;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .dark-theme .container-main {
            background: var(--bg-dark);
            box-shadow: 0 8px 24px rgba(109, 40, 217, 0.4);
        }
        .container-main:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 32px rgba(244, 114, 182, 0.5);
        }
        .dark-theme .container-main:hover {
            box-shadow: 0 12px 32px rgba(109, 40, 217, 0.5);
        }
        h1 {
            font-size: 2.8rem;
            font-weight: 700;
            color: var(--text-light);
            text-align: center;
            margin-bottom: 2rem;
        }
        .dark-theme h1 {
            color: var(--secondary-dark);
        }
        h2 {
            font-size: 1.6rem;
            font-weight: 500;
            color: var(--primary-light);
        }
        .dark-theme h2 {
            color: var(--primary-dark);
        }
        .card {
            background: var(--bg-light);
            border-radius: 24px;
            border: 1px solid var(--secondary-light);
            padding: 1.5rem;
            margin-bottom: 2rem;
            transition: transform 0.3s ease, border-color 0.3s ease;
        }
        .dark-theme .card {
            background: var(--bg-dark);
            border-color: var(--secondary-dark);
        }
        .card:hover {
            transform: translateY(-8px);
            border-color: var(--primary-light);
        }
        .dark-theme .card:hover {
            border-color: var(--primary-dark);
        }
        .form-control {
            border-radius: 12px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .form-control:focus {
            border-color: var(--secondary-light);
            box-shadow: 0 0 8px rgba(251, 191, 36, 0.5);
        }
        .dark-theme .form-control:focus {
            border-color: var(--secondary-dark);
            box-shadow: 0 0 8px rgba(217, 119, 6, 0.5);
        }
        .btn-primary {
            background: linear-gradient(45deg, var(--secondary-light), #F59E0B);
            border: none;
            color: var(--text-light);
            font-weight: 500;
            border-radius: 12px;
            padding: 0.8rem 1.5rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .dark-theme .btn-primary {
            background: linear-gradient(45deg, var(--secondary-dark), #B45309);
            color: var(--text-dark);
        }
        .btn-primary:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.5);
        }
        .dark-theme .btn-primary:hover {
            box-shadow: 0 4px 12px rgba(217, 119, 6, 0.5);
        }
        .btn-secondary {
            background: linear-gradient(45deg, var(--primary-light), #EC4899);
            border: none;
            color: #FFFFFF;
            font-weight: 500;
            border-radius: 12px;
            padding: 0.8rem 1.5rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .dark-theme .btn-secondary {
            background: linear-gradient(45deg, var(--primary-dark), #5B21B6);
        }
        .btn-secondary:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(244, 114, 182, 0.5);
        }
        .dark-theme .btn-secondary:hover {
            box-shadow: 0 4px 12px rgba(109, 40, 217, 0.5);
        }
        .btn-danger {
            background: linear-gradient(45deg, #DC2626, #B91C1C);
            border: none;
            color: #FFFFFF;
            font-weight: 500;
            border-radius: 12px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .btn-danger:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.5);
        }
        .dropdown-toggle {
            background: linear-gradient(45deg, var(--primary-light), var(--secondary-light));
            color: #FFFFFF;
            border: none;
            border-radius: 8px;
            padding: 0.5rem;
            font-size: 1.8rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .dark-theme .dropdown-toggle {
            background: linear-gradient(45deg, var(--primary-dark), var(--secondary-dark));
        }
        .dropdown-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(244, 114, 182, 0.5);
        }
        .dark-theme .dropdown-toggle:hover {
            box-shadow: 0 4px 12px rgba(109, 40, 217, 0.5);
        }
        .dropdown-menu {
            background: var(--bg-light);
            border: 1px solid var(--primary-light);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(244, 114, 182, 0.3);
        }
        .dark-theme .dropdown-menu {
            background: var(--bg-dark);
            border-color: var(--primary-dark);
            box-shadow: 0 4px 12px rgba(109, 40, 217, 0.3);
        }
        .dropdown-item {
            color: var(--text-light);
            transition: background 0.3s ease;
        }
        .dark-theme .dropdown-item {
            color: var(--text-dark);
        }
        .dropdown-item:hover {
            background: rgba(251, 191, 36, 0.1);
        }
        .dark-theme .dropdown-item:hover {
            background: rgba(217, 119, 6, 0.1);
        }
        #calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            background: var(--bg-light);
            border-radius: 16px;
            padding: 1rem;
        }
        .dark-theme #calendar {
            background: var(--bg-dark);
        }
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .calendar-header h3 {
            font-size: 1.4rem;
            font-weight: 500;
            color: var(--primary-light);
        }
        .dark-theme .calendar-header h3 {
            color: var(--primary-dark);
        }
        .calendar-nav {
            display: flex;
            gap: 0.5rem;
        }
        .calendar-nav i {
            cursor: pointer;
            color: var(--secondary-light);
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }
        .dark-theme .calendar-nav i {
            color: var(--secondary-dark);
        }
        .calendar-nav i:hover {
            transform: scale(1.2);
        }
        .calendar-day {
            padding: 0.5rem;
            text-align: center;
            font-size: 0.9rem;
            min-height: 60px;
            position: relative;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .calendar-day.header {
            font-weight: 500;
            color: var(--primary-light);
        }
        .dark-theme .calendar-day.header {
            color: var(--primary-dark);
        }
        .calendar-day.has-event {
            background: var(--secondary-light);
            color: var(--text-light);
            border: 2px solid var(--primary-light);
            border-radius: 8px;
            opacity: 0.9;
            cursor: pointer;
        }
        .dark-theme .calendar-day.has-event {
            background: var(--secondary-dark);
            border-color: var(--primary-dark);
            color: var(--text-dark);
        }
        .calendar-day.has-event:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.5);
        }
        .dark-theme .calendar-day.has-event:hover {
            box-shadow: 0 4px 12px rgba(217, 119, 6, 0.5);
        }
        .calendar-day.today {
            background: var(--primary-light);
            color: #FFFFFF;
            border-radius: 8px;
        }
        .dark-theme .calendar-day.today {
            background: var(--primary-dark);
            color: #FFFFFF;
        }
        .event-count {
            background: var(--secondary-dark);
            color: #FFFFFF;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            margin: 4px auto;
            transition: transform 0.3s ease;
        }
        .dark-theme .event-count {
            background: var(--secondary-light);
        }
        .event-count:hover {
            transform: scale(1.2);
            box-shadow: 0 2px 8px rgba(251, 191, 36, 0.5);
        }
        .dark-theme .event-count:hover {
            box-shadow: 0 2px 8px rgba(217, 119, 6, 0.5);
        }
        .day-events-list li {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.8rem 0;
            border-bottom: 1px solid rgba(251, 191, 36, 0.2);
            transition: background 0.3s ease;
        }
        .dark-theme .day-events-list li {
            border-bottom-color: rgba(217, 119, 6, 0.2);
        }
        .day-events-list li:hover {
            background: rgba(251, 191, 36, 0.1);
        }
        .dark-theme .day-events-list li:hover {
            background: rgba(217, 119, 6, 0.1);
        }
        .event-actions {
            display: flex;
            gap: 8px;
        }
        .event-actions .icon-btn {
            font-size: 1.1rem;
            transition: transform 0.3s ease;
        }
        .event-actions .icon-btn:hover {
            transform: scale(1.2) rotate(360deg);
        }
        .whatsapp-btn { color: var(--whatsapp); }
        .whatsapp-btn:hover { color: var(--whatsapp-hover); }
        .ok-btn { color: var(--secondary-light); }
        .dark-theme .ok-btn { color: var(--secondary-dark); }
        .ok-btn:hover { color: #F59E0B; animation: pulse 1s infinite; }
        .dark-theme .ok-btn:hover { color: #B45309; }
        .apply-btn { color: var(--text-light); }
        .dark-theme .apply-btn { color: var(--text-dark); }
        .apply-btn:hover { color: #374151; }
        .dark-theme .apply-btn:hover { color: #9CA3AF; }
        .maint-btn { color: var(--secondary-light); }
        .dark-theme .maint-btn { color: var(--secondary-dark); }
        .maint-btn:hover { color: #F59E0B; }
        .dark-theme .maint-btn:hover { color: #B45309; }
        .badge-application {
            background: var(--secondary-light);
            color: var(--text-light);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            transition: transform 0.3s ease;
        }
        .dark-theme .badge-application {
            background: var(--secondary-dark);
            color: var(--text-dark);
        }
        .badge-application:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(251, 191, 36, 0.3);
        }
        .dark-theme .badge-application:hover {
            box-shadow: 0 2px 8px rgba(217, 119, 6, 0.3);
        }
        .badge-maintenance {
            background: var(--primary-light);
            color: #FFFFFF;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            transition: transform 0.3s ease;
        }
        .dark-theme .badge-maintenance {
            background: var(--primary-dark);
        }
        .badge-maintenance:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(244, 114, 182, 0.3);
        }
        .dark-theme .badge-maintenance:hover {
            box-shadow: 0 2px 8px rgba(109, 40, 217, 0.3);
        }
        @keyframes pulse {
            0% { transform: scale(1.2); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1.2); }
        }
        .input-group-text {
            background: rgba(243, 231, 247, 0.5);
            border-color: var(--secondary-light);
            color: var(--secondary-light);
            border-radius: 12px 0 0 12px;
        }
        .dark-theme .input-group-text {
            background: rgba(55, 65, 81, 0.5);
            border-color: var(--secondary-dark);
            color: var(--secondary-dark);
        }
        .table th {
            background: linear-gradient(45deg, var(--primary-light), #EC4899);
            color: #FFFFFF;
            font-weight: 500;
            border: none;
        }
        .dark-theme .table th {
            background: linear-gradient(45deg, var(--primary-dark), #5B21B6);
        }
        .table th::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--secondary-light);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        .dark-theme .table th::after {
            background: var(--secondary-dark);
        }
        .table th:hover::after {
            transform: scaleX(1);
        }
        .table td {
            height: 15px;
            font-size: .6em;
            transition: background 0.3s ease, transform 0.3s ease;
            vertical-align: bottom;
        }
        .table td:hover {
            background: rgba(251, 191, 36, 0.1);
            transform: scale(1.02);
        }
        .dark-theme .table td:hover {
            background: rgba(217, 119, 6, 0.1);
        }
        .whatsapp-icon {
            color: var(--whatsapp);
            font-size: 1.1rem;
            margin-right: 5px;
            transition: transform 0.3s ease;
        }
        .whatsapp-icon:hover {
            color: var(--whatsapp-hover);
            transform: scale(1.2) rotate(360deg);
        }
        .search-highlight {
            background: rgba(243, 231, 247, 0.5);
            border: 2px solid var(--secondary-light);
            animation: highlight 1s ease-out;
        }
        .dark-theme .search-highlight {
            background: rgba(55, 65, 81, 0.5);
            border-color: var(--secondary-dark);
        }
        @keyframes highlight {
            from { background-color: rgba(251, 191, 36, 0.3); }
            to { background-color: rgba(243, 231, 247, 0.5); }
        }
        .dark-theme @keyframes highlight {
            from { background-color: rgba(217, 119, 6, 0.3); }
            to { background-color: rgba(55, 65, 81, 0.5); }
        }
        #searchInput {
            border-radius: 0 12 0 12;
            max-width: fit-content;
            border: solid 1.5px var(--secondary-light);
        }
        #searchInput:focus + .input-group-text .bi-search {
            animation: heartbeat 1s infinite;
            color: var(--secondary-light);
        }
        .dark-theme #searchInput:focus + .input-group-text .bi-search {
            color: var(--secondary-dark);
        }
        @keyframes heartbeat {
            0% { transform: scale(1); }
            20% { transform: scale(1.2); }
            40% { transform: scale(1); }
            60% { transform: scale(1.2); }
            80% { transform: scale(1); }
        }
        .theme-toggle {
            color: var(--secondary-light);
            font-size: 1.8rem;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .dark-theme .theme-toggle {
            color: var(--secondary-dark);
        }
        .theme-toggle:hover {
            transform: rotate(360deg);
        }
        #currentDateTime {
            font-size: 1.1rem;
            color: var(--secondary-light);
            font-weight: 500;
        }
        .dark-theme #currentDateTime {
            color: var(--secondary-dark);
        }
        .modal-content {
            border-radius: 24px;
            background: var(--bg-light);
            box-shadow: 0 8px 24px rgba(244, 114, 182, 0.4);
        }
        .dark-theme .modal-content {
            background: var(--bg-dark);
            box-shadow: 0 8px 24px rgba(109, 40, 217, 0.4);
        }
        .modal-header {
            background: linear-gradient(45deg, var(--primary-light), #EC4899);
            color: #FFFFFF;
            border-radius: 24px 24px 0 0;
        }
        .dark-theme .modal-header {
            background: linear-gradient(45deg, var(--primary-dark), #5B21B6);
        }
        .modal-footer {
            border: none;
            justify-content: flex-end;
        }
        .client-details-list li {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 0.5rem 0;
        }
        .client-details-list li i {
            color: var(--secondary-light);
            font-size: 1.1rem;
            animation: pulse 2s infinite;
        }
        .dark-theme .client-details-list li i {
            color: var(--secondary-dark);
        }
        @media (max-width: 768px) {
            .container-main {
                padding: 1rem;
            }
            .calendar-day {
                font-size: 0.7rem;
                min-height: 60px;
                padding: 0.3rem;
            }
            .event-count {
                width: 16px;
                height: 16px;
                font-size: 0.6rem;
            }
            .day-events-list li {
                font-size: 0.9rem;
                padding: 0.5rem 0;
            }
            .navbar-brand {
                font-size: 1.6rem;
            }
            .theme-toggle, .dropdown-toggle {
                font-size: 1.5rem;
            }
            .badge-application, .badge-maintenance {
                font-size: 0.7rem;
            }
            #currentDateTime {
                font-size: 0.9rem;
            }
        }
        
        small{
            background: #fff;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Gerenciamento de C√≠lios</a>
            <div class="d-flex align-items-center gap-2">
                <span id="currentDateTime"></span>
                <i id="themeToggle" class="bi bi-sun-fill theme-toggle" aria-label="Alternar tema"></i>
                <div class="dropdown">
                    <button class="dropdown-toggle" type="button" id="actionMenu" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-list"></i>
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="actionMenu">
                        <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#cadastroModal">Novo Cliente</a></li>
                        <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#messageConfigModal">Configurar Mensagens</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>
    <div class="container-main">
        <div id="agenda" class="card" data-aos="fade-up">
            <div class="card-body">
                <h2><i class="bi bi-calendar-week-fill"></i> Agenda de Manuten√ß√µes</h2>
                <div class="calendar-header">
                    <h3 id="calendarTitle"></h3>
                    <div class="calendar-nav">
                        <i class="bi bi-chevron-left" id="prevMonth"></i>
                        <i class="bi bi-chevron-right" id="nextMonth"></i>
                    </div>
                </div>
                <div id="calendar"></div>
            </div>
        </div>
        <div id="clients-list" class="card" data-aos="fade-up">
            <h2><i class="bi bi-people-fill"></i> Clientes Cadastrados</h2>
            <div class="mb-3">
                <div class="input-group" style="max-width: 600px;">
                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                    <input type="text" class="form-control" id="searchInput" placeholder="Pesquisar..." aria-label="Pesquisar clientes">
                </div>
            </div>
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>WhatsApp</th>
                        </tr>
                    </thead>
                    <tbody id="clients-table-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal de Cadastro/Edi√ß√£o -->
    <div class="modal fade" id="cadastroModal" tabindex="-1" aria-labelledby="cadastroModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="cadastroModalLabel">Cadastrar Cliente</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="cadastroForm">
                        <input type="hidden" id="editId" name="editId">
                        <div class="mb-3">
                            <label for="name" class="form-label">Nome:</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-person-fill"></i></span>
                                <input type="text" class="form-control" id="name" name="name" required aria-label="Nome do cliente">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="whatsapp" class="form-label">WhatsApp:</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fa-brands fa-whatsapp"></i></span>
                                <input type="tel" class="form-control" id="whatsapp" name="whatsapp" pattern="\+55\s?\d{2}\s?\d{9}" placeholder="+55 11 91234-5678" required aria-label="WhatsApp do cliente">
                            </div>
                            <small class="form-text text-muted">Formato: +55 11 91234-5678</small>
                        </div>
                        <div class="mb-3">
                            <label for="appointment_type" class="form-label">Tipo de Agendamento:</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-calendar-check"></i></span>
                                <select class="form-control" id="appointment_type" name="appointment_type" required aria-label="Tipo de agendamento">
                                    <option value="">Selecione o tipo</option>
                                    <option value="application">Aplica√ß√£o</option>
                                    <option value="maintenance">Manuten√ß√£o</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="appointment_date" class="form-label" id="appointment_date_label">Data:</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-calendar-date-fill"></i></span>
                                <input type="date" class="form-control" id="appointment_date" name="appointment_date" required aria-label="Data do agendamento">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="appointment_time" class="form-label" id="appointment_time_label">Hor√°rio:</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-clock-fill"></i></span>
                                <input type="time" class="form-control" id="appointment_time" name="appointment_time" min="00:00" max="00:00" required aria-label="Hor√°rio do agendamento">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="application_value" class="form-label">Valor da Aplica√ß√£o:</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-currency-exchange"></i></span>
                                <input type="number" class="form-control" id="application_value" name="application_value" step="0.01" min="0" required aria-label="Valor da aplica√ß√£o">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="maintenance_value" class="form-label">Valor da Manuten√ß√£o:</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-currency-exchange"></i></span>
                                <input type="number" class="form-control" id="maintenance_value" name="maintenance_value" step="0.01" min="0" required aria-label="Valor da manuten√ß√£o">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="eyelash_model" class="form-label">Modelo do C√≠lios:</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-eye-fill"></i></span>
                                <select class="form-control" id="eyelash_model" name="eyelash_model" required aria-label="Modelo do c√≠lios">
                                    <option value="">Selecione o modelo</option>
                                    <option value="brasileiro">Brasileiro</option>
                                    <option value="egipcio">Eg√≠pcio</option>
                                    <option value="4d">4D</option>
                                    <option value="5d">5D</option>
                                    <option value="fio_a_fio">Fio a Fio</option>
                                    <option value="fox">Fox</option>
                                </select>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary" aria-label="Salvar cliente"><i class="bi bi-save-fill"></i> Salvar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Configura√ß√£o de Mensagens -->
    <div class="modal fade" id="messageConfigModal" tabindex="-1" aria-labelledby="messageConfigModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="messageConfigModalLabel">Configurar Mensagens do WhatsApp</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-tabs" id="messageTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="application-tab" data-bs-toggle="tab" data-bs-target="#application" type="button" role="tab" aria-controls="application" aria-selected="true">Aplica√ß√£o</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="maintenance-tab" data-bs-toggle="tab" data-bs-target="#maintenance" type="button" role="tab" aria-controls="maintenance" aria-selected="false">Manuten√ß√£o</button>
                        </li>
                    </ul>
                    <div class="tab-content" id="messageTabContent">
                        <div class="tab-pane fade show active" id="application" role="tabpanel" aria-labelledby="application-tab">
                            <form id="applicationMessageForm" class="mt-3">
                                <div class="mb-3">
                                    <label for="applicationMessageTemplate" class="form-label">Modelo da Mensagem de Aplica√ß√£o:</label>
                                    <textarea class="form-control" id="applicationMessageTemplate" name="applicationMessageTemplate" rows="5" required aria-label="Template de mensagem de aplica√ß√£o"></textarea>
                                    <small class="form-text text-muted">Use as vari√°veis: {nome}, {data_agendamento}, {hora_agendamento}, {valor_aplicacao}, {valor_manutencao}</small>
                                </div>
                                <div class="modal-footer">
                                    <button type="submit" class="btn btn-primary" aria-label="Salvar template de aplica√ß√£o"><i class="bi bi-save-fill"></i> Salvar</button>
                                </div>
                            </form>
                        </div>
                        <div class="tab-pane fade" id="maintenance" role="tabpanel" aria-labelledby="maintenance-tab">
                            <form id="maintenanceMessageForm" class="mt-3">
                                <div class="mb-3">
                                    <label for="maintenanceMessageTemplate" class="form-label">Modelo da Mensagem de Manuten√ß√£o:</label>
                                    <textarea class="form-control" id="maintenanceMessageTemplate" name="maintenanceMessageTemplate" rows="5" required aria-label="Template de mensagem de manuten√ß√£o"></textarea>
                                    <small class="form-text text-muted">Use as vari√°veis: {nome}, {data_agendamento}, {hora_agendamento}, {valor_aplicacao}, {valor_manutencao}</small>
                                </div>
                                <div class="modal-footer">
                                    <button type="submit" class="btn btn-primary" aria-label="Salvar template de manuten√ß√£o"><i class="bi bi-save-fill"></i> Salvar</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Nova Manuten√ß√£o -->
    <div class="modal fade" id="newMaintenanceModal" tabindex="-1" aria-labelledby="newMaintenanceModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="newMaintenanceModalLabel">Agendar Nova Manuten√ß√£o</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="newMaintenanceForm">
                        <input type="hidden" id="maintenanceId" name="maintenanceId">
                        <div class="mb-3">
                            <label for="new_maintenance_date" class="form-label">Data da Manuten√ß√£o:</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-calendar-event-fill"></i></span>
                                <input type="date" class="form-control" id="new_maintenance_date" name="new_maintenance_date" required aria-label="Nova data da manuten√ß√£o">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="new_maintenance_time" class="form-label">Hor√°rio da Manuten√ß√£o:</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-clock-fill"></i></span>
                                <input type="time" class="form-control" id="new_maintenance_time" name="new_maintenance_time" min="00:00" max="00:00" required aria-label="Novo hor√°rio da manuten√ß√£o">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="new_maintenance_value" class="form-label">Valor da Manuten√ß√£o:</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-currency-exchange"></i></span>
                                <input type="number" class="form-control" id="new_maintenance_value" name="new_maintenance_value" step="0.01" min="0" required aria-label="Novo valor da manuten√ß√£o">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="new_eyelash_model" class="form-label">Modelo do C√≠lios:</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-eye-fill"></i></span>
                                <select class="form-control" id="new_eyelash_model" name="new_eyelash_model" required aria-label="Novo modelo do c√≠lios">
                                    <option value="">Selecione o modelo</option>
                                    <option value="brasileiro">Brasileiro</option>
                                    <option value="egipcio">Eg√≠pcio</option>
                                    <option value="4d">4D</option>
                                    <option value="5d">5D</option>
                                    <option value="fio_a_fio">Fio a Fio</option>
                                    <option value="fox">Fox</option>
                                </select>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary" aria-label="Salvar nova manuten√ß√£o"><i class="bi bi-save-fill"></i> Salvar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Detalhes do Cliente -->
    <div class="modal fade" id="clientDetailsModal" tabindex="-1" aria-labelledby="clientDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="clientDetailsModalLabel">Detalhes do Cliente</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <ul class="client-details-list" id="client-details-list"></ul>
                    <div class="modal-footer">
                        <a id="whatsappApplicationLink" href="#" target="_blank" class="btn btn-primary" aria-label="Enviar mensagem de aplica√ß√£o"><i class="bi bi-calendar-check"></i> Aplica√ß√£o</a>
                        <a id="whatsappMaintenanceLink" href="#" target="_blank" class="btn btn-primary" aria-label="Enviar mensagem de manuten√ß√£o"><i class="bi bi-wrench-adjustable"></i> Manuten√ß√£o</a>
                        <button id="editClientButton" class="btn btn-primary" aria-label="Editar cliente"><i class="bi bi-pencil-square"></i> Editar</button>
                        <button id="deleteClientButton" class="btn btn-danger" aria-label="Excluir cliente"><i class="bi bi-trash-fill"></i> Excluir</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Eventos do Dia -->
    <div class="modal fade" id="dayEventsModal" tabindex="-1" aria-labelledby="dayEventsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="dayEventsModalLabel">Eventos</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <ul class="day-events-list" id="day-events-list"></ul>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
    <script>
        const API_CLIENTS = 'https://683d14e6199a0039e9e427bd.mockapi.io/Dados';

        const eyelashModels = {
            brasileiro: 'Brasileiro',
            egipcio: 'Eg√≠pcio',
            '4d': '4D',
            '5d': '5D',
            fio_a_fio: 'Fio a Fio',
            fox: 'Fox'
        };

        const defaultApplicationMessageTemplate = `üíñ *Lembrete de agendamento*\n\nOl√° {nome}, tudo bem?\n\n‚ú® Sua aplica√ß√£o de c√≠lios est√° agendada para *{data_agendamento}*.\n\nConfira os detalhes abaixo:\n\n‚è∞ Hor√°rio: {hora_agendamento}\nüí∏ Valor: {valor_aplicacao}\n\nüìå Em caso de atraso, por favor avise com pelo menos 2 horas de anteced√™ncia.\n\nüìå Se houver necessidade de remarcar, pe√ßo que avise com no m√≠nimo 1 dia de anteced√™ncia.\n\nEm caso de d√∫vidas ou imprevistos, √© s√≥ me chamar! üí¨\nAgrade√ßo pela confian√ßa üíï`;

        const defaultMaintenanceMessageTemplate = `üíñ *Lembrete de agendamento*\n\nOl√° {nome}, tudo bem?\n\n‚ú® Sua manuten√ß√£o de c√≠lios est√° agendada para *{data_agendamento}*.\n\nConfira os detalhes abaixo:\n\n‚è∞ Hor√°rio: {hora_agendamento}\nüí∏ Valor: {valor_manutencao}\n\nüìå Em caso de atraso, por favor avise com pelo menos 2 horas de anteced√™ncia.\n\nüìå Se houver necessidade de remarcar, pe√ßo que avise com no m√≠nimo 1 dia de anteced√™ncia.\n\nEm caso de d√∫vidas ou imprevistos, √© s√≥ me chamar! üí¨\nAgrade√ßo pela confian√ßa üíï`;

        let currentDate = new Date();

        function formatDate(dateStr) {
            const [year, month, day] = dateStr.split('-');
            return `${day}/${month}/${year}`;
        }

        function formatTime(timeStr) {
            const [hours, minutes] = timeStr.split(':');
            return `${hours}:${minutes}`;
        }

        function updateDateTime() {
            const now = new Date();
            const day = String(now.getDate()).padStart(2, '0');
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const year = now.getFullYear();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('currentDateTime').textContent = `${day}/${month}/${year} ${hours}:${minutes}`;
        }

        function toggleTheme() {
            const body = document.body;
            const themeToggle = document.getElementById('themeToggle');
            if (body.classList.contains('dark-theme')) {
                body.classList.remove('dark-theme');
                themeToggle.classList.remove('bi-moon-stars-fill');
                themeToggle.classList.add('bi-sun-fill');
                localStorage.setItem('theme', 'light');
            } else {
                body.classList.add('dark-theme');
                themeToggle.classList.remove('bi-sun-fill');
                themeToggle.classList.add('bi-moon-stars-fill');
                localStorage.setItem('theme', 'dark');
            }
        }

        function updateAppointmentLabels() {
            const type = document.getElementById('appointment_type').value;
            const dateLabel = document.getElementById('appointment_date_label');
            const timeLabel = document.getElementById('appointment_time_label');
            if (type === 'application') {
                dateLabel.textContent = 'Data da Aplica√ß√£o';
                timeLabel.textContent = 'Hor√°rio da Aplica√ß√£o';
            } else if (type === 'maintenance') {
                dateLabel.textContent = 'Data da Manuten√ß√£o';
                timeLabel.textContent = 'Hor√°rio da Manuten√ß√£o';
            } else {
                dateLabel.textContent = 'Data';
                timeLabel.textContent = 'Hor√°rio';
            }
        }

        async function getClients() {
            try {
                const response = await fetch(API_CLIENTS);
                if (!response.ok) throw new Error('Erro ao buscar clientes');
                return await response.json();
            } catch (error) {
                console.error(error);
                alert('Falha ao carregar clientes. Tente novamente.');
                return [];
            }
        }

        async function saveClients(client, isEdit = false) {
            try {
                const method = isEdit ? 'PUT' : 'POST';
                const url = isEdit ? `${API_CLIENTS}/${client.id}` : API_CLIENTS;
                const response = await fetch(url, {
                    method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(client)
                });
                if (!response.ok) throw new Error('Erro ao salvar cliente');
                return await response.json();
            } catch (error) {
                console.error(error);
                alert('Falha ao salvar cliente. Tente novamente.');
            }
        }

        async function deleteClient(id) {
            if (!confirm('Deseja realmente excluir este cliente?')) return;
            try {
                const response = await fetch(`${API_CLIENTS}/${id}`, { method: 'DELETE' });
                if (!response.ok) throw new Error('Erro ao excluir cliente');
                await updateClientsTable(document.getElementById('searchInput').value);
                await updateCalendar();
                bootstrap.Modal.getInstance(document.getElementById('clientDetailsModal')).hide();
                alert('Cliente exclu√≠do com sucesso!');
            } catch (error) {
                console.error(error);
                alert('Falha ao excluir cliente. Tente novamente.');
            }
        }

        function getApplicationMessageTemplate() {
            return localStorage.getItem('applicationMessageTemplate') || defaultApplicationMessageTemplate;
        }

        function saveApplicationMessageTemplate(template) {
            localStorage.setItem('applicationMessageTemplate', template);
        }

        function getMaintenanceMessageTemplate() {
            return localStorage.getItem('maintenanceMessageTemplate') || defaultMaintenanceMessageTemplate;
        }

        function saveMaintenanceMessageTemplate(template) {
            localStorage.setItem('maintenanceMessageTemplate', template);
        }

        function validateForm(client) {
            const today = new Date().toISOString().split('T')[0];
            if (client.appointment_date < today) {
                alert('A data do agendamento n√£o pode ser anterior a hoje.');
                return false;
            }
            const whatsappRegex = /^\+55\s?\d{2}\s?\d{9}$/;
            if (!whatsappRegex.test(client.whatsapp)) {
                alert('Por favor, insira um WhatsApp v√°lido no formato +55 11 91234-5678.');
                return false;
            }
            if (!client.appointment_type) {
                alert('Por favor, selecione o tipo de agendamento.');
                return false;
            }
            return true;
        }

        function validateMaintenanceForm(maintenance) {
            const today = new Date().toISOString().split('T')[0];
            if (maintenance.new_maintenance_date < today) {
                alert('A data da manuten√ß√£o n√£o pode ser anterior a hoje.');
                return false;
            }
            return true;
        }

        async function generateWhatsAppMessage(client, type) {
            const template = type === 'application' ? getApplicationMessageTemplate() : getMaintenanceMessageTemplate();
            return template
                .replace('{nome}', client.name)
                .replace('{data_agendamento}', formatDate(client.appointment_date))
                .replace('{hora_agendamento}', formatTime(client.appointment_time))
                .replace('{valor_aplicacao}', parseFloat(client.application_value).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }))
                .replace('{valor_manutencao}', parseFloat(client.maintenance_value).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }));
        }

        async function generateWhatsAppLink(client, type) {
            const message = await generateWhatsAppMessage(client, type);
            const encodedMessage = encodeURIComponent(message);
            return `https://wa.me/${client.whatsapp.replace(/\s/g, '')}?text=${encodedMessage}`;
        }

        async function openWhatsAppLink(id) {
    const clients = await getClients();
    const client = clients.find(c => c.id === id);
    if (!client) {
        alert('Cliente n√£o encontrado.');
        return;
    }
    const link = `https://wa.me/${client.whatsapp.replace(/\s/g, '')}`;
    window.open(link, '_blank');
}

        async function showClientDetails(id) {
            const clients = await getClients();
            const client = clients.find(c => c.id === id);
            if (!client) {
                alert('Cliente n√£o encontrado.');
                return;
            }
            const detailsList = document.getElementById('client-details-list');
            detailsList.innerHTML = `
                <li><i class="bi bi-person-fill"></i> <strong>Nome:</strong> ${client.name}</li>
                <li><i class="fa-brands fa-whatsapp"></i> <strong>WhatsApp:</strong> ${client.whatsapp}</li>
                <li><i class="bi bi-calendar-check"></i> <strong>Tipo de Agendamento:</strong> ${client.appointment_type === 'application' ? 'Aplica√ß√£o' : 'Manuten√ß√£o'}</li>
                <li><i class="bi bi-calendar-date-fill"></i> <strong>Data do Agendamento:</strong> ${formatDate(client.appointment_date)}</li>
                <li><i class="bi bi-clock-fill"></i> <strong>Hor√°rio do Agendamento:</strong> ${formatTime(client.appointment_time)}</li>
                <li><i class="bi bi-currency-exchange"></i> <strong>Valor da Aplica√ß√£o:</strong> ${parseFloat(client.application_value).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</li>
                <li><i class="bi bi-currency-exchange"></i> <strong>Valor da Manuten√ß√£o:</strong> ${parseFloat(client.maintenance_value).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</li>
                <li><i class="bi bi-eye-fill"></i> <strong>Modelo do C√≠lios:</strong> ${eyelashModels[client.eyelash_model] || client.eyelash_model}</li>
            `;
            document.getElementById('whatsappApplicationLink').href = await generateWhatsAppLink(client, 'application');
            document.getElementById('whatsappMaintenanceLink').href = await generateWhatsAppLink(client, 'maintenance');
            document.getElementById('editClientButton').onclick = () => editClient(id);
            document.getElementById('deleteClientButton').onclick = () => deleteClient(id);
            bootstrap.Modal.getOrCreateInstance(document.getElementById('clientDetailsModal')).show();
        }

        async function showDayEvents(dateStr) {
            const clients = await getClients();
            const events = clients.filter(client => client.appointment_date === dateStr);
            const modal = document.getElementById('dayEventsModal');
            const modalTitle = document.getElementById('dayEventsModalLabel');
            const eventsList = document.getElementById('day-events-list');
            modalTitle.textContent = `Eventos em ${formatDate(dateStr)}`;
            eventsList.innerHTML = '';
            for (const client of events) {
                const li = document.createElement('li');
                const badgeClass = client.appointment_type === 'application' ? 'badge-application' : 'badge-maintenance';
                const badgeText = client.appointment_type === 'application' ? 'Aplica√ß√£o' : 'Manuten√ß√£o';
                li.innerHTML = `
                    <span onclick="showClientDetails('${client.id}')">${client.name} - ${formatTime(client.appointment_time)} <span class="${badgeClass}">${badgeText}</span></span>
                    <div class="event-actions">
                        <a href="${await generateWhatsAppLink(client, client.appointment_type)}" target="_blank" class="icon-btn whatsapp-btn"><i class="fa-brands fa-whatsapp"></i></a>
                        <span onclick="openNewMaintenance('${client.id}')" class="icon-btn ok-btn"><i class="bi bi-check-circle-fill"></i></span>
                        <a href="${await generateWhatsAppLink(client, 'application')}" target="_blank" class="icon-btn apply-btn"><i class="bi bi-calendar-check"></i></a>
                        <a href="${await generateWhatsAppLink(client, 'maintenance')}" target="_blank" class="icon-btn maint-btn"><i class="bi bi-wrench-adjustable"></i></a>
                    </div>
                `;
                eventsList.appendChild(li);
            }
            bootstrap.Modal.getOrCreateInstance(modal).show();
        }

        async function updateClientsTable(searchTerm = '') {
            const clients = await getClients();
            const tbody = document.getElementById('clients-table-body');
            tbody.innerHTML = '';
            let filteredClients = clients.map(client => ({ ...client }));
            
            if (searchTerm) {
                const lowerSearchTerm = searchTerm.toLowerCase();
                filteredClients = filteredClients.filter(client => 
                    client.name.toLowerCase().includes(lowerSearchTerm) ||
                    client.whatsapp.toLowerCase().includes(lowerSearchTerm) ||
                    formatDate(client.appointment_date).includes(lowerSearchTerm)
                );
            }

            filteredClients.forEach((client, idx) => {
                const row = document.createElement('tr');
                const isHighlighted = searchTerm && (
                    client.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    client.whatsapp.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    formatDate(client.appointment_date).includes(searchTerm.toLowerCase())
                );
                if (isHighlighted) row.classList.add('search-highlight');
                row.setAttribute('data-aos', 'fade-up');
                row.setAttribute('data-aos-delay', idx * 100);
                row.innerHTML = `
                    <td onclick="showClientDetails('${client.id}')"><i class="bi bi-person-fill"></i> ${client.name}</td>
                    <td onclick="openWhatsAppLink('${client.id}', '${client.appointment_type}')"><i class="fa-brands fa-whatsapp whatsapp-icon"></i> ${client.whatsapp}</td>
                `;
                tbody.appendChild(row);
            });
        }

        async function updateCalendar() {
            const clients = await getClients();
            const calendar = document.getElementById('calendar');
            const calendarTitle = document.getElementById('calendarTitle');
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const today = new Date();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDay = firstDay.getDay();
            const daysInMonth = lastDay.getDate();

            calendarTitle.textContent = `${firstDay.toLocaleString('pt-BR', { month: 'long' })} ${year}`;
            calendar.innerHTML = `
                <div class="calendar-day header">Dom</div>
                <div class="calendar-day header">Seg</div>
                <div class="calendar-day header">Ter</div>
                <div class="calendar-day header">Qua</div>
                <div class="calendar-day header">Qui</div>
                <div class="calendar-day header">Sex</div>
                <div class="calendar-day header">S√°b</div>
            `;

            for (let i = 0; i < startDay; i++) {
                calendar.innerHTML += `<div class="calendar-day"></div>`;
            }

            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const events = clients.filter(client => client.appointment_date === dateStr);
                const isToday = today.getDate() === day && today.getMonth() === month && today.getFullYear() === year;
                const hasEvent = events.length > 0;
                const eventHTML = hasEvent ? `<div class="event-count">${events.length}</div>` : '';
                calendar.innerHTML += `
                    <div class="calendar-day ${isToday ? 'today' : ''} ${hasEvent ? 'has-event' : ''}" ${hasEvent ? `onclick="showDayEvents('${dateStr}')"` : ''}>
                        <span>${day}</span>
                        ${eventHTML}
                    </div>
                `;
            }
        }

        async function editClient(id) {
            const clients = await getClients();
            const client = clients.find(c => c.id === id);
            if (!client) {
                alert('Cliente n√£o encontrado.');
                return;
            }
            const modal = document.getElementById('cadastroModal');
            const modalTitle = document.getElementById('cadastroModalLabel');
            modalTitle.textContent = 'Editar Cliente';
            document.getElementById('editId').value = id;
            document.getElementById('name').value = client.name;
            document.getElementById('whatsapp').value = client.whatsapp;
            document.getElementById('appointment_type').value = client.appointment_type;
            document.getElementById('appointment_date').value = client.appointment_date;
            document.getElementById('appointment_time').value = client.appointment_time;
            document.getElementById('application_value').value = client.application_value;
            document.getElementById('maintenance_value').value = client.maintenance_value;
            document.getElementById('eyelash_model').value = client.eyelash_model;
            updateAppointmentLabels();
            bootstrap.Modal.getOrCreateInstance(modal).show();
            bootstrap.Modal.getInstance(document.getElementById('clientDetailsModal')).hide();
        }

        async function openNewMaintenance(id) {
            const modal = document.getElementById('newMaintenanceModal');
            document.getElementById('maintenanceId').value = id;
            document.getElementById('new_maintenance_date').value = '';
            document.getElementById('new_maintenance_time').value = '';
            document.getElementById('new_maintenance_value').value = '';
            document.getElementById('new_eyelash_model').value = '';
            bootstrap.Modal.getOrCreateInstance(modal).show();
        }

        function searchClients() {
            const searchInput = document.getElementById('searchInput').value;
            updateClientsTable(searchInput);
        }

        document.getElementById('cadastroForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const client = {};
            for (let [key, value] of formData.entries()) {
                client[key] = value;
            }
            if (!validateForm(client)) return;
            const isEdit = !!client.editId;
            if (isEdit) client.id = client.editId;
            delete client.editId;
            const savedClient = await saveClients(client, isEdit);
            if (savedClient) {
                await updateClientsTable(document.getElementById('searchInput').value);
                await updateCalendar();
                this.reset();
                document.getElementById('editId').value = '';
                document.getElementById('cadastroModalLabel').textContent = 'Cadastrar Cliente';
                updateAppointmentLabels();
                bootstrap.Modal.getInstance(document.getElementById('cadastroModal')).hide();
                alert(isEdit ? 'Cliente atualizado com sucesso!' : 'Cliente cadastrado com sucesso!');
            }
        });

        document.getElementById('newMaintenanceForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const maintenance = {};
            for (let [key, value] of formData.entries()) {
                maintenance[key] = value;
            }
            if (!validateMaintenanceForm(maintenance)) return;
            const clients = await getClients();
            const client = clients.find(c => c.id === maintenance.maintenanceId);
            if (!client) {
                alert('Cliente n√£o encontrado.');
                return;
            }
            client.appointment_type = 'maintenance';
            client.appointment_date = maintenance.new_maintenance_date;
            client.appointment_time = maintenance.new_maintenance_time;
            client.maintenance_value = maintenance.new_maintenance_value;
            client.eyelash_model = maintenance.new_eyelash_model;
            const savedClient = await saveClients(client, true);
            if (savedClient) {
                await updateClientsTable(document.getElementById('searchInput').value);
                await updateCalendar();
                this.reset();
                bootstrap.Modal.getInstance(document.getElementById('newMaintenanceModal')).hide();
                alert('Nova manuten√ß√£o agendada com sucesso!');
            }
        });

        document.getElementById('applicationMessageForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const template = formData.get('applicationMessageTemplate');
            saveApplicationMessageTemplate(template);
            alert('Modelo de mensagem de aplica√ß√£o salvo com sucesso!');
        });

        document.getElementById('maintenanceMessageForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const template = formData.get('maintenanceMessageTemplate');
            saveMaintenanceMessageTemplate(template);
            alert('Modelo de mensagem de manuten√ß√£o salvo com sucesso!');
        });

        document.getElementById('searchInput').addEventListener('input', searchClients);

        document.getElementById('themeToggle').addEventListener('click', toggleTheme);

        document.getElementById('appointment_type').addEventListener('change', updateAppointmentLabels);

        document.getElementById('prevMonth').addEventListener('click', function() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            updateCalendar();
        });

        document.getElementById('nextMonth').addEventListener('click', function() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            updateCalendar();
        });

        document.addEventListener('DOMContentLoaded', async function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-theme');
                document.getElementById('themeToggle').classList.remove('bi-sun-fill');
                document.getElementById('themeToggle').classList.add('bi-moon-stars-fill');
            }
            await updateClientsTable();
            await updateCalendar();
            document.getElementById('applicationMessageTemplate').value = getApplicationMessageTemplate();
            document.getElementById('maintenanceMessageTemplate').value = getMaintenanceMessageTemplate();
            updateDateTime();
            setInterval(updateDateTime, 1000);
            AOS.init({ duration: 800, once: true });
        });
    </script>
</body>
</html>